console.info(`${logPreface("JS")} calendar.js loaded`);var currentMonth,currentYear,currentDay;$(document).on("show.bs.modal",".modal",function(){let a=1040+10*$(".modal:visible").length;$(this).css("z-index",a),setTimeout(function(){$(".modal-backdrop").not(".modal-stack").css("z-index",a-1).addClass("modal-stack")},0)}),$(function(){$("[data-toggle=\"tooltip\"]").tooltip(),$(".clockpicker").clockpicker(),currentMonth=new Date().getMonth(),currentYear=new Date().getFullYear(),getEvents().then(function(a){buildCalendarTable(currentYear,currentMonth,a)}).catch(function(a){console.warn(a)}),$("#calendar-root").on("event:change",function(){getEvents().then(function(a){buildCalendarTable(currentYear,currentMonth,a)}).catch(function(a){console.warn(a)})}),$("#eventListModal").on("show.bs.modal",function(a){$("#eventListModal").off("event:change").on("event:change",function(){showEventList(currentDay,currentMonth,currentYear)});let b=$(a.relatedTarget),c=b.data("day");currentDay=c;let d=b.data("month"),e=b.data("year"),f=$(this);f.find(".modal-title").html("Events"),showEventList(c,d,e)})});function showEventList(a,b,c){let d=document.getElementById("eventListModalBody");$(d).html(""),getEvents().then(function(e){if(e.forEach(e=>{let f=new Date(e.start),g=new Date(e.end),h=new Date(`${c}-${b+1}-${a}`);if(h>=f&&h<=g||isSameDay(toUNIX(h),toUNIX(f))){let a=createEventCard(e);if(0!=$(d).children().length){let b=!1;$(d).children().each(function(){if(new Date(`1/1/2000/${$(this).attr("data-time")}`)>=new Date(`1/1/2000/${$(a).attr("data-time")}`))return $(this).before($(a)),b=!0,!1}),b||d.appendChild(a)}else d.appendChild(a)}}),0==$(d).children().length){let a=document.createElement("span");$(a).html(`<h4>This day has no events.</h4> <span class="text-muted">Press the  <kbd><svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-calendar-plus-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
      <path fill-rule="evenodd" d="M4 .5a.5.5 0 0 0-1 0V1H2a2 2 0 0 0-2 2v1h16V3a2 2 0 0 0-2-2h-1V.5a.5.5 0 0 0-1 0V1H4V.5zM0 5h16v9a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V5zm8.5 3.5a.5.5 0 0 0-1 0V10H6a.5.5 0 0 0 0 1h1.5v1.5a.5.5 0 0 0 1 0V11H10a.5.5 0 0 0 0-1H8.5V8.5z"/>
    </svg></kbd>  button to add one. You find it in the toolbar.</span>`),d.appendChild(a)}}).catch(function(a){console.warn(a)})}function goBackward(){0==currentMonth?getEvents().then(function(a){buildCalendarTable(currentYear-1,11,a),--currentYear,currentMonth=11}).catch(function(a){console.warn(a)}):getEvents().then(function(a){buildCalendarTable(currentYear,currentMonth-1,a),--currentMonth}).catch(function(a){console.warn(a)})}function goForward(){11==currentMonth?getEvents().then(function(a){buildCalendarTable(currentYear+1,0,a),++currentYear,currentMonth=0}).catch(function(a){console.warn(a)}):getEvents().then(function(a){buildCalendarTable(currentYear,currentMonth+1,a),++currentMonth}).catch(function(a){console.warn(a)})}function goToday(){getEvents().then(function(a){let b=new Date;currentYear=b.getFullYear(),currentMonth=b.getMonth(),buildCalendarTable(b.getFullYear(),b.getMonth(),a);let c=$("#calendar-table").find(".calendar-today");c.addClass("impulse"),setTimeout(function(){c.removeClass("impulse")},1e3)}).catch(function(a){console.warn(a)})}months=["January","Feburary","March","April","May","June","July","August","September","October","November","December"];function buildCalendarTable(a,b,c){$("#calendar-root").html(""),$("#control-currentMonth").text(`${months[b]} ${a}`);let d=(new Date(a,b).getDay()+6)%7,e=new Date(a,b+1,0).getDate(),f=1;cellIndex=1;let g,h=$("<table></table>").addClass("table table").attr("id","calendar-table");thead=$("<thead class='thead'><tr><th>Montag</th><th>Dienstag</th><th>Mittwoch</th><th>Donnerstag</th><th>Freitag</th><th>Samstag</th><th>Sonntag</th></tr></thead>"),h.append(thead);for(let i=1;7>i;i++){row=$("<tr></tr>").addClass("calendar-row");for(let h=1;8>h;h++){if(cellIndex<=d||f>e)g=$("<td></td>").addClass("calendar-offday"),row.append(g);else{g=$("<td></td>"),g.addClass("calendar-day"),g.attr("id","calendar-day"+f),g.attr("data-toggle","modal"),g.attr("data-target","#eventListModal"),g.attr("data-day",f),g.attr("data-month",b),g.attr("data-year",a),b==new Date().getMonth()&&f==new Date().getDate()&&a==new Date().getFullYear()&&g.addClass("calendar-today"),g.append(`<h2>${f}</h2>`);let d=document.createElement("ul");$(d).attr("id",`day${f}`),d.className="list-group list-group-flush",c.forEach(c=>{let e=new Date(c.start),g=new Date(c.end),h=new Date(`${a}-${b+1}-${f}`);if(h>=e&&h<=g||isSameDay(toUNIX(h),toUNIX(e))){let a=document.createElement("li");if(isSameDay(toUNIX(h),toUNIX(e))?$(a).addClass(`list-group-item in-calendar-li ${getStatusClass(c.status)}`).html(`${new Date(c.start).toLocaleTimeString(["de-DE"],{hour:"2-digit",minute:"2-digit"})} <b>${c.title}</b>`):$(a).addClass(`list-group-item ${getStatusClass(c.status)}`).html(`<b>${c.title}</b>`),$(a).attr("data-time",new Date(c.start).toLocaleTimeString(["de-DE"],{hour:"2-digit",minute:"2-digit"})),0!=$(d).children().length){let b=!1;$(d).children().each(function(){if(new Date(`1/1/2000/${$(this).attr("data-time")}`)>=new Date("1/1/2000/"+$(a).attr("data-time")))return $(this).before($(a)),b=!0,!1}),b||d.appendChild(a)}else d.appendChild(a)}}),g.append(d),row.append(g),f++}cellIndex++}h.append(row)}$("#calendar-root").append(h)}function getStatusClass(a){switch(a){case"Busy":a="status-blue";break;case"Tentative":a="status-blue stripes";break;case"Free":a="status-purple stripes";break;default:a="";}return a}