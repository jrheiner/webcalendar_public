console.info(`${logPreface("JS")} custom.js loaded`);var errorDetails={code:"0",description:"Client configuration error<br>Check <u><a href='ReadMe.md.html' target='_blank' rel='noopener' class='text-danger'>ReadMe.md</a></u> for more information"};function deleteEvent(a){return new Promise(function(b,c){$.ajax({url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/events/${a}`,method:"DELETE",timeout:5e3}).done(function(){console.log(`${logPreface("XHR")} deleteEvent(${a}) success`),showNotification("success","Success!","Event deleted."),b()}).fail(function(a,b,d){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to delete event."):showNotification("error","Request failed!",`Failed to delete event. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),c(a.responseText)})})}function getEvents(){return new Promise(function(a,b){$.ajax({url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/events/`,method:"GET",timeout:5e3}).done(function(b){console.log(`${logPreface("XHR")} getEvents() success`),a(b)}).fail(function(a,c,d){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to load events."):showNotification("error","Request failed!",`Failed to load events. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),b(a.responseText)})})}function getEventsDetails(a){return new Promise(function(b,c){$.ajax({url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/events/${a}`,method:"GET",timeout:5e3}).done(function(c){console.log(`${logPreface("XHR")} getEventsDetails(${a}) success`),b(c)}).fail(function(a,b,d){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to load event details."):showNotification("error","Request failed!",`Failed to load event details. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),c(a.responseText)})})}function getCategories(){return new Promise(function(a,b){$.ajax({url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/categories/`,method:"GET",timeout:5e3}).done(function(b){console.log(`${logPreface("XHR")} getCategories() success`),a(b)}).fail(function(a,c,d){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to load categories."):showNotification("error","Request failed!",`Failed to load categories. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),b(a.responseText)})})}function addEvent(a){return new Promise(function(b,c){$.ajax({type:"POST",url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/events/`,data:JSON.stringify(a),dataType:"json",timeout:5e3}).done(function(a){console.group(`${logPreface("XHR")} addEvent(data) success`),console.table(a),console.groupEnd(),showNotification("success","Success!",`Added <i>${a.title}</i> as new event.`),b(a)}).fail(function(a,b,d){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to add new event."):showNotification("error","Request failed!",`Failed to add new event. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),c(errorDetails)})})}function editEvent(a,b){return new Promise(function(c,d){$.ajax({type:"PUT",url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/events/${b}`,data:JSON.stringify(a),dataType:"json",timeout:5e3}).done(function(a){console.group(`${logPreface("XHR")} editEvent(data, ${b}) success`),console.table(a),console.groupEnd(),showNotification("success","Success!",`Updated <i>${a.title}</i>.`),c(a)}).fail(function(a,b,c){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==c.statusText?showNotification("error","Request timeout!","Failed to update event."):showNotification("error","Request failed!",`Failed to update event. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),d(errorDetails)})})}function createCategory(a){return data={name:a},new Promise(function(b,c){$.ajax({type:"POST",url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/categories/`,data:JSON.stringify(data),dataType:"json",timeout:5e3}).done(function(c){console.log(`${logPreface("XHR")} createCategory(${a}) success`),showNotification("success","Success!",`Added <i>${a}</i> as new category.`),b(c)}).fail(function(a,b,d){null!=a.responseText&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to new category."):showNotification("error","Request failed!",`Failed to new category. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),c(errorDetails)})})}function deleteCategory(a){return new Promise(function(b,c){$.ajax({url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/categories/${a}`,method:"DELETE",timeout:5e3}).done(function(){console.log(`${logPreface("XHR")} deleteCategory(${a}) success`),showNotification("success","Success!","Category deleted."),b()}).fail(function(a,b,d){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to delete category."):showNotification("error","Request failed!",`Failed to delete category. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),c(a.responseText)})})}function deleteImageFromEvent(a){return new Promise(function(b,c){$.ajax({url:`http://dhbw.radicalsimplicity.com/calendar/${getDatabaseUser()}/images/${a}`,method:"DELETE",timeout:5e3}).done(function(){console.log(`${logPreface("XHR")} deleteImageFromEvent(${a}) success`),b()}).fail(function(a,b,d){a.responseText!=null&&(errorDetails=JSON.parse(a.responseText)),"timeout"==d.statusText?showNotification("error","Request timeout!","Failed to delete image."):showNotification("error","Request failed!",`Failed to delete image. <br> <small class='text-monospace font-italic text-danger'> Code ${errorDetails.code}: ${errorDetails.description}</small>`),c(a.responseText)})})}function getDefaultImage(){let a=+localStorage.getItem("defaultImage")||3;return setDefaultImage(a),+a}function setDefaultImage(a){localStorage.setItem("defaultImage",a)}function getDatabaseUser(){let a=localStorage.getItem("databaseUser")||"6177815";return setDatabaseUser(a),a}function setDatabaseUser(a){localStorage.setItem("databaseUser",a)}function createEventCard(a){let b=document.createElement("div");b.className="card",$(b).attr("data-time",new Date(a.start).toLocaleTimeString(["de-DE"],{hour:"2-digit",minute:"2-digit"})),$(b).attr("id",`event-${a.id}`);let c=document.createElement("div");c.className="row no-gutters";let d=document.createElement("div");d.className="col-sm-1";let e=document.createElement("img");e.className="img-fluid rounded ml-2 mt-2 mb-2",$(e).attr("src",a.imageurl||`img/default/${getDefaultImage()}_placeholder.png`);let f=document.createElement("div");f.className="card-body";let g=document.createElement("h5");g.innerText=a.title,g.className="card-title";let h=document.createElement("h6");h.innerText=doubleTimeDisplay(a.start,a.end),h.className="card-subtitle mb-2 text-muted";let i=document.createElement("button");i.className="btn btn-outline-success btn-sm mr-3",i.innerHTML="Details",$(i).attr("type","button"),$(i).attr("data-toggle","modal"),$(i).attr("data-target","#modal-details"),$(i).attr("data-id",a.id);let j=document.createElement("button");j.className="btn btn-outline-primary btn-sm mx-1",j.innerHTML=`<svg width="1.25em" height="1.25em" viewBox="0 0 16 16" class="bi bi-pencil-square" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456l-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
    <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
  </svg>`,$(j).attr("type","button"),$(j).attr("data-toggle","modal"),$(j).attr("data-target","#modal-edit"),$(j).attr("data-id",a.id);let k=document.createElement("button");return k.className="btn btn-outline-danger btn-sm mx-1",k.innerHTML=`<svg width="1.25em" height="1.25em" viewBox="0 0 16 16" class="bi bi-trash-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path fill-rule="evenodd" d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5a.5.5 0 0 0-1 0v7a.5.5 0 0 0 1 0v-7z"/>
  </svg>`,$(k).attr("type","button"),$(k).attr("data-toggle","modal"),$(k).attr("data-target","#modal-delete"),$(k).attr("data-name",a.title),$(k).attr("data-start",a.start),$(k).attr("data-end",a.end),$(k).attr("data-organizer",a.organizer),$(k).attr("data-id",a.id),d.appendChild(e),f.appendChild(g),f.appendChild(h),f.appendChild(i),f.appendChild(j),f.appendChild(k),c.appendChild(d),c.appendChild(f),b.appendChild(c),b}function getCategoriesForEvent(a){getCategories().then(function(b){loadCategories(b,a)}).catch(function(a){console.warn(a)})}function loadCategories(a,b){let c=document.getElementById("category-checkboxes"),d=document.createElement("div");d.className="pt-2 pb-1",d.innerText="Categories";let e=document.createElement("small");e.className="form-text text-muted",e.innerText="Optional.";let f=document.createElement("div");a.forEach(a=>{let c=!1;JSON.stringify(b).includes(a.name)&&(c=!0);let d=buildCheckbox(`checkbox${a.id}`,a.name,c);f.appendChild(d)}),$(c).empty(),$(c).append(d),$(c).append(f)}function buildCheckbox(a,b,c){let d=document.createElement("div");return d.className="form-check form-check-inline p-1",input=document.createElement("input"),input.className="form-check-input",input.id=a,$(input).attr("type","checkbox"),$(input).attr("name",a),$(input).prop("checked",c),label=document.createElement("label"),label.className="form-check-label",$(label).attr("for",a),label.innerText=b,d.appendChild(input),d.appendChild(label),d}function formToJson(a,b=null){let c=$(a).serializeArray();categoriesArray=[],c.forEach(a=>{a.name.includes("checkbox")&&categoriesArray.push({id:a.name.slice(8)})});let d={title:c[0].value,location:c[1].value,organizer:c[2].value,start:`${c[4].value}T${c[5].value}`,end:`${c[6].value}T${c[7].value}`,status:$("#input-status").val(),allday:!1,webpage:c[3].value,imagedata:b,categories:categoriesArray,extra:c[c.length-1].value||null};return d}function sortMapByDate(a,c="new"){let d=[];a.forEach(function(a,b){d.push([b,a])},a),d.sort(function(d,a){let b=new Date(d[0]),e=new Date(a[0]);return"new"==c?e-b:b-e});let e=new Map;return d.map(a=>{e.set(a[0],a[1])}),e}function createICSString(a,b,c,d,e,f,g,h){let i=`
BEGIN:VCALENDAR\r
VERSION:2.0\r
PRODID:-//DHBW Webcalendar//6177815//EN\r
BEGIN:VTIMEZONE\r
TZID:Europe/Berlin\r
BEGIN:DAYLIGHT\r
TZOFFSETFROM:+0100\r
TZOFFSETTO:+0200\r
TZNAME:CEST\r
DTSTART:19700329T020000\r
RRULE:FREQ=YEARLY;INTERVAL=1;BYDAY=-1SU;BYMONTH=3\r
END:DAYLIGHT\r
BEGIN:STANDARD\r
TZOFFSETFROM:+0200\r
TZOFFSETTO:+0100\r
TZNAME:CET\r
DTSTART:19701025T030000\r
RRULE:FREQ=YEARLY;INTERVAL=1;BYDAY=-1SU;BYMONTH=10\r
END:STANDARD\r
END:VTIMEZONE\r
BEGIN:VEVENT\r
UID:${a}\r
DTSTAMP:${new Date().toISOString().replace(/-|:|\.|Z/gi,"").slice(0,-3)}Z\r
DTSTART:${h}Z\r
DTEND:${g}Z\r
SUMMARY:${b}\r
ORGANIZER:${c}\r
URL:${d?d:"No webpage available"}\r
LOCATION:${e?e:"No location available"}\r
DESCRIPTION:${f.trim()}\r
END:VEVENT\r
END:VCALENDAR\r`;return i.trim()}function showNotification(a,b,c){let d=buildToast(),e={error:{icon:`<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-exclamation-triangle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 5zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/>
          </svg>&nbsp;&nbsp;`,color:"bg-danger"},info:{icon:`<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-info-circle-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412l-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
          </svg>&nbsp;&nbsp;`,color:"bg-info"},success:{icon:`<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-square-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd" d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
          </svg>&nbsp;&nbsp;`,color:"bg-success"}};$(d).addClass(e[a].color),$(d).find("strong").html(e[a].icon+b),$(d).find("small").text(timestampDE()),$(d).find(".toast-body").html(c),$("#notification-holder").prepend(d),$(d).toast("show")}function buildToast(){return root=document.createElement("div"),$(root).addClass("toast"),$(root).attr("role","alert"),$(root).attr("data-autohide",!0),$(root).attr("data-delay",15e3),header=document.createElement("div"),$(header).addClass("toast-header"),title=document.createElement("strong"),$(title).addClass("mr-auto"),timestamp=document.createElement("small"),$(timestamp).addClass("ml-4"),closeBtn=document.createElement("button"),$(closeBtn).addClass("ml-2 mb-1 close").html("<span>&times;</span>"),$(closeBtn).attr("data-dismiss","toast"),body=document.createElement("div"),$(body).addClass("toast-body bg-light"),header.appendChild(title),header.appendChild(timestamp),header.appendChild(closeBtn),root.appendChild(header),root.appendChild(body),root}function toUNIX(a){return new Date(a).getTime()/1e3}function fromUNIX(a){return new Date(1e3*a)}function singleDateTimeDisplay(a){let b=new Date(a);return year=b.getFullYear(),month=b.getMonth()+1,day=b.getDate(),hour=b.getHours(),min=b.getMinutes(),`${year}.${addLeadingZero(month)}.${addLeadingZero(day)} ${addLeadingZero(hour)}:${addLeadingZero(min)}`}function singleDateDisplay(a){weekdays=["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"];let b=new Date(a);return year=b.getFullYear(),month=b.getMonth()+1,day=b.getDate(),weekday=b.getDay(),`${weekdays[weekday]} ${addLeadingZero(day)}.${addLeadingZero(month)}.${year}`}function doubleDateTimeDisplay(a,b){let c=new Date(a),d=new Date(b);return year1=c.getFullYear(),month1=c.getMonth()+1,day1=c.getDate(),hour1=c.getHours(),min1=c.getMinutes(),year2=d.getFullYear(),month2=d.getMonth()+1,day2=d.getDate(),hour2=d.getHours(),min2=d.getMinutes(),isSameDay(toUNIX(c),toUNIX(d))?`${addLeadingZero(day1)}.${addLeadingZero(month1)}.${year1} ${addLeadingZero(hour1)}:${addLeadingZero(min1)} - ${addLeadingZero(hour2)}:${addLeadingZero(min2)}`:`${addLeadingZero(day1)}.${addLeadingZero(month1)}.${year1} ${addLeadingZero(hour1)}:${addLeadingZero(min1)} - ${addLeadingZero(day2)}.${addLeadingZero(month2)}.${year2} ${addLeadingZero(hour2)}:${addLeadingZero(min2)}`}function doubleTimeDisplay(a,b){let c=new Date(a),d=new Date(b);return hour1=c.getHours(),min1=c.getMinutes(),year2=d.getFullYear(),month2=d.getMonth()+1,day2=d.getDate(),hour2=d.getHours(),min2=d.getMinutes(),isSameDay(toUNIX(c),toUNIX(d))?addLeadingZero(hour1)+":"+addLeadingZero(min1)+" - "+addLeadingZero(hour2)+":"+addLeadingZero(min2):addLeadingZero(hour1)+":"+addLeadingZero(min1)+" - "+addLeadingZero(day2)+"."+addLeadingZero(month2)+"."+year2+" "+addLeadingZero(hour2)+":"+addLeadingZero(min2)}function dateFormat(a){let b=new Date(a);return year=b.getFullYear(),month=b.getMonth()+1,day=b.getDate(),year+"-"+month+"-"+day}function timestampDE(){let a=new Date;return hour=a.getHours(),min=a.getMinutes(),sec=a.getSeconds(),`${addLeadingZero(hour)}:${addLeadingZero(min)}:${addLeadingZero(sec)}`}function logPreface(a){return`[${timestampDE()}] - ${a} -`}function isSameDay(a,b){return date1=fromUNIX(a),date2=fromUNIX(b),date1.getFullYear()==date2.getFullYear()&&date1.getMonth()==date2.getMonth()&&date1.getDate()==date2.getDate()}function isTomorrow(a,b){return date1=fromUNIX(a),date2=fromUNIX(b),date2.setDate(date2.getDate()+1),isSameDay(toUNIX(date1),toUNIX(date2))}function addLeadingZero(a){return 10>a&&(a="0"+a),a}